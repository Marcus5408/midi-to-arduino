/*
2.07 - Challenge 2: Jingle all the Way
--------------------------------------
By Issac Liu, Pd 7/8 Odd
12/8/2024

Uses a void-type function to buzz,
playing out a melody.
*/

// Set up the melody array.
// Each row contains a frequency, duration, and velocity.
// The melody array tends to be too large to fit in SRAM,
// so it is stored in PROGMEM instead.
const PROGMEM int melody[630][3] = {
  { 349, 0, 64 },
  { 349, 788, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 440, 1, 64 },
  { 440, 788, 0 },
  { 523, 1, 64 },
  { 523, 130, 0 },
  { 466, 1, 64 },
  { 466, 130, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 349, 1, 64 },
  { 349, 788, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 64 },
  { 261, 1314, 0 },
  { 261, 527, 76 },
  { 261, 130, 0 },
  { 261, 1, 76 },
  { 261, 130, 0 },
  { 293, 1, 76 },
  { 293, 130, 0 },
  { 349, 1, 76 },
  { 349, 262, 0 },
  { 349, 1, 76 },
  { 349, 130, 0 },
  { 349, 0, 64 },
  { 349, 788, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 440, 1, 64 },
  { 440, 788, 0 },
  { 523, 1, 64 },
  { 523, 130, 0 },
  { 466, 1, 64 },
  { 466, 130, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 349, 1, 64 },
  { 349, 788, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 64 },
  { 261, 1314, 0 },
  { 261, 527, 76 },
  { 261, 130, 0 },
  { 261, 1, 76 },
  { 261, 130, 0 },
  { 293, 1, 76 },
  { 293, 130, 0 },
  { 349, 1, 76 },
  { 349, 262, 0 },
  { 349, 1, 76 },
  { 349, 130, 0 },
  { 293, 527, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 329, 1, 64 },
  { 329, 393, 0 },
  { 293, 1, 64 },
  { 293, 130, 0 },
  { 261, 1, 64 },
  { 261, 1314, 0 },
  { 293, 790, 64 },
  { 293, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 525, 0 },
  { 261, 1, 64 },
  { 261, 262, 0 },
  { 523, 1, 64 },
  { 523, 262, 0 },
  { 523, 264, 64 },
  { 523, 262, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 293, 527, 64 },
  { 293, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 329, 527, 64 },
  { 329, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 788, 0 },
  { 293, 790, 64 },
  { 293, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 525, 0 },
  { 349, 527, 64 },
  { 349, 1314, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 525, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 293, 1053, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 391, 264, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 391, 1, 80 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 349, 1, 80 },
  { 349, 393, 0 },
  { 329, 1, 80 },
  { 329, 130, 0 },
  { 293, 1, 80 },
  { 293, 262, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 525, 0 },
  { 391, 1, 80 },
  { 391, 262, 0 },
  { 329, 1, 80 },
  { 329, 393, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 391, 1, 80 },
  { 391, 525, 0 },
  { 349, 1, 80 },
  { 349, 1051, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 391, 1, 80 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 523, 1, 80 },
  { 523, 525, 0 },
  { 329, 1, 80 },
  { 329, 262, 0 },
  { 349, 1, 80 },
  { 349, 393, 0 },
  { 329, 1, 80 },
  { 329, 130, 0 },
  { 293, 1, 80 },
  { 293, 262, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 525, 0 },
  { 391, 1, 80 },
  { 391, 262, 0 },
  { 329, 1, 80 },
  { 329, 393, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 261, 1, 80 },
  { 261, 525, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 391, 1, 80 },
  { 391, 525, 0 },
  { 349, 1, 80 },
  { 349, 1051, 0 },
  { 293, 790, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 391, 1, 64 },
  { 391, 525, 0 },
  { 329, 527, 64 },
  { 329, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 788, 0 },
  { 293, 790, 64 },
  { 293, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 523, 264, 64 },
  { 523, 262, 0 },
  { 523, 1, 64 },
  { 523, 262, 0 },
  { 391, 1, 64 },
  { 391, 525, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 264, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 329, 264, 64 },
  { 329, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 788, 0 },
  { 293, 527, 64 },
  { 293, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 391, 527, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 525, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 349, 1, 64 },
  { 349, 1314, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 525, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 262, 0 },
  { 261, 1, 64 },
  { 261, 262, 0 },
  { 261, 1, 64 },
  { 261, 525, 0 },
  { 261, 790, 64 },
  { 261, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 329, 1, 64 },
  { 329, 262, 0 },
  { 349, 1, 64 },
  { 349, 262, 0 },
  { 293, 1, 64 },
  { 293, 262, 0 },
  { 391, 264, 64 },
  { 391, 262, 0 },
  { 440, 1, 64 },
  { 440, 262, 0 },
  { 391, 1, 64 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 391, 1, 80 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 349, 1, 80 },
  { 349, 393, 0 },
  { 329, 1, 80 },
  { 329, 130, 0 },
  { 293, 1, 80 },
  { 293, 262, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 525, 0 },
  { 391, 1, 80 },
  { 391, 262, 0 },
  { 329, 1, 80 },
  { 329, 393, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 261, 1, 80 },
  { 261, 525, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 391, 1, 80 },
  { 391, 525, 0 },
  { 349, 1, 80 },
  { 349, 1051, 0 },
  { 261, 1, 112 },
  { 261, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 349, 1, 112 },
  { 349, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 440, 1, 112 },
  { 440, 393, 0 },
  { 440, 1, 112 },
  { 440, 393, 0 },
  { 391, 1, 112 },
  { 391, 788, 0 },
  { 261, 1, 112 },
  { 261, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 349, 1, 112 },
  { 349, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 523, 1, 112 },
  { 523, 525, 0 },
  { 329, 1, 112 },
  { 329, 262, 0 },
  { 349, 1, 112 },
  { 349, 393, 0 },
  { 329, 1, 112 },
  { 329, 130, 0 },
  { 293, 1, 112 },
  { 293, 262, 0 },
  { 261, 1, 112 },
  { 261, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 349, 1, 112 },
  { 349, 130, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 349, 1, 112 },
  { 349, 525, 0 },
  { 391, 1, 112 },
  { 391, 262, 0 },
  { 329, 1, 112 },
  { 329, 393, 0 },
  { 293, 1, 112 },
  { 293, 130, 0 },
  { 261, 1, 112 },
  { 261, 525, 0 },
  { 261, 1, 112 },
  { 261, 262, 0 },
  { 391, 1, 112 },
  { 391, 525, 0 },
  { 349, 1, 112 },
  { 349, 1051, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 391, 1, 80 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 349, 1, 80 },
  { 349, 393, 0 },
  { 329, 1, 80 },
  { 329, 130, 0 },
  { 293, 1, 80 },
  { 293, 262, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 525, 0 },
  { 391, 1, 80 },
  { 391, 262, 0 },
  { 329, 1, 80 },
  { 329, 393, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 391, 1, 80 },
  { 391, 525, 0 },
  { 349, 1, 80 },
  { 349, 1051, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 440, 1, 80 },
  { 440, 393, 0 },
  { 391, 1, 80 },
  { 391, 788, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 391, 1, 80 },
  { 391, 393, 0 },
  { 349, 1, 80 },
  { 349, 393, 0 },
  { 329, 1, 80 },
  { 329, 130, 0 },
  { 293, 1, 80 },
  { 293, 262, 0 },
  { 261, 1, 80 },
  { 261, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 130, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 349, 1, 80 },
  { 349, 525, 0 },
  { 391, 1, 80 },
  { 391, 262, 0 },
  { 329, 1, 80 },
  { 329, 393, 0 },
  { 293, 1, 80 },
  { 293, 130, 0 },
  { 261, 1, 80 },
  { 261, 525, 0 },
  { 261, 1, 80 },
  { 261, 262, 0 },
  { 391, 1, 80 },
  { 391, 525, 0 },
  { 349, 1, 80 },
  { 349, 1051, 0 },
};
int passBuzzer = 9;

void setup() {
  pinMode(passBuzzer, OUTPUT);
  Serial.begin(9600);
}

void buzz(int frequency, int duration, int velocity) {
  // Map the velocity (0-127) to a duty cycle (0-255)
  int dutyCycle = map(velocity, 0, 127, 0, 255);

  // Play the tone with the calculated duty cycle
  analogWrite(passBuzzer, dutyCycle);
  tone(passBuzzer, frequency, duration);
  delay(duration);
  noTone(passBuzzer);
  analogWrite(passBuzzer, 0);
}

// Calculate the length of the melody array
int melodyLength = sizeof melody / sizeof melody[0];
void loop() {
  // Iterate through the melody array
  for (int i = 0; i < melodyLength; i++) {
    // Read the frequency, duration, and velocity from the melody array.
    // Because the melody array is stored in PROGMEM, we use pgm_read_word
    // to read the values.
    int frequency = pgm_read_word(&melody[i][0]);
    long duration = pgm_read_word(&melody[i][1]);
    int velocity = pgm_read_word(&melody[i][2]);

    // Debug print the frequency, duration, and velocity
    Serial.print("Frequency: ");
    Serial.print(frequency);
    Serial.print(" Duration: ");
    Serial.print(duration);
    Serial.print(" Velocity: ");
    Serial.println(velocity);

    // Play the note
    buzz(frequency, duration, velocity);
  }
  // Restart the melody after a 3 second delay
  delay(3000);
}
